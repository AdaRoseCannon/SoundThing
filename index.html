<!DOCTYPE html>
<html>
<head>
	<title>Test</title>
	<style>
	    html, body {
	        margin:0;
	        padding:0;
	        width:100%;
	        height:100%;
	    }
	
	    canvas{
	        width:100%;
	        height:100%;
    	    left:0;
    	    top:0;
	    }
	</style>
	<script type="text/javascript" charset="utf-8" async defer>
		var audioContext;
		var analyser;
		var freqData;
		var min;
		var max;
		var ctx;
		var WIDTH;
		var HEIGHT;
		var requestAnimFrame = (function () {
			return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function (callback) {
				window.setTimeout(callback, 1000 / 60);
			};
		})();
		window.addEventListener('load', init, false);
		function init() {
			// success callback when requesting audio input stream
			function gotStream(stream) {
			    window.AudioContext = window.AudioContext || window.webkitAudioContext;
			    var audioContext = new AudioContext();
 
			    // Create an AudioNode from the stream.
			    var mediaStreamSource = audioContext.createMediaStreamSource( stream );
			    analyser = audioContext.createAnalyser();
			    mediaStreamSource.connect( analyser );
			    freqData = new Float32Array(analyser.frequencyBinCount);
			    // Connect it to the destination to hear yourself (or any other node for processing!)
 
				var canvas = document.createElement('canvas');
				WIDTH  = analyser.frequencyBinCount;
				HEIGHT = WIDTH * document.documentElement.clientHeight / document.documentElement.clientWidth;
				canvas.width = WIDTH;
				canvas.height = HEIGHT;
				canvas.style.zIndex   = -1;
				canvas.style.position = "absolute";
				canvas.style.border   = "1px solid";
				document.body.appendChild(canvas);
				ctx = canvas.getContext("2d");
				draw(getData ());
			}
			navigator.getUserMedia = navigator.getUserMedia || navigator.mozGetUserMedia || navigator.webkitGetUserMedia;
			navigator.getUserMedia( {audio:true}, gotStream, function (err) {
				console.log(err);
			} );
 
		}
 
		function getData () {
			analyser.getFloatFrequencyData(freqData);
			return freqData;
		}
 
		function draw(data) {
			ctx.clearRect(0,0,WIDTH,HEIGHT)
			ctx.beginPath();
			min = analyser.minDecibels;
		    max = analyser.maxDecibels;
			ctx.moveTo(0,(data[i]-min)/(max-min));
			for(var i=1;i<data.length;i++){
				var x=i;
				var y=HEIGHT-HEIGHT*(data[i]-min)/(max-min);
				ctx.lineTo(x,y);
			}
			ctx.stroke();
			requestAnimFrame(function () {
				draw(getData ());
			});
		}
	</script>
</head>
<body>
 
</body>
</html>
